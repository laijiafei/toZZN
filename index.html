<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>ç»“å©šçºªå¿µæ—¥å¿«ä¹</title>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Noto+Serif+SC:wght@300;700&display=swap" rel="stylesheet">
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            /* æ·±é‚ƒæ˜Ÿç©ºèƒŒæ™¯ */
            background: radial-gradient(circle at center, #200d2b 0%, #11051e 60%, #000000 100%);
            overflow: hidden;
            display: flex;
            perspective: 1000px; /* 3D æ™¯æ·±ï¼Œè‡³å…³é‡è¦ */
            transform-style: preserve-3d;
            height: 100vh;
            font-family: 'Noto Serif SC', serif;
        }

        /* ====== å¼€åœºé®ç½© ====== */
        #start-mask {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: linear-gradient(135deg, #2a0845 0%, #6441A5 100%);
            z-index: 9999;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: opacity 1.5s ease;
        }
        
        #start-mask h1 {
            color: #fff;
            font-family: 'Dancing Script', cursive;
            font-size: 3.5rem;
            margin-bottom: 40px;
            text-shadow: 0 0 10px rgba(255,255,255,0.5);
            text-align: center;
            padding: 0 20px;
        }

        .heart-container { display: flex; flex-direction: column; align-items: center; gap: 20px; }
        .heart-outer {
            position: relative; width: 120px; height: 120px;
            border: 3px solid rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
            cursor: pointer; overflow: hidden;
        }
        .heart-inner {
            position: absolute; bottom: 0; left: 0;
            width: 100%; height: 0%;
            background: linear-gradient(to top, #ff6b9d, #ff8fab);
            transition: height 0.1s linear;
        }
        .heart-icon { font-size: 3rem; z-index: 2; color: #fff; }
        .heart-instruction {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1.2rem;
            font-family: 'Dancing Script', cursive;
            margin-top: 10px;
        }

        /* è¤ç«è™« */
        .firefly {
            position: absolute;
            width: 4px; height: 4px;
            background-color: #d8bfd8;
            border-radius: 50%;
            box-shadow: 0 0 10px #d8bfd8, 0 0 20px #e6e6fa;
            animation: fly 10s linear infinite;
            opacity: 0; pointer-events: none;
        }

        /* ====== 3D æ ¸å¿ƒå®¹å™¨ ====== */
        #drag-container {
            position: relative;
            display: flex;
            margin: auto;
            transform-style: preserve-3d; /* ä¿æŠ¤ 3D ç»“æ„ */
            transform: rotateX(-10deg);
        }

        #spin-container {
            position: relative;
            display: flex;
            margin: auto;
            transform-style: preserve-3d;
            width: 120px; height: 170px;
        }

        #spin-container img {
            transform-style: preserve-3d;
            position: absolute;
            left: 0; top: 0;
            width: 100%; height: 100%;
            object-fit: cover;
            border: 5px solid #fff; 
            border-bottom: 20px solid #fff;
            box-shadow: 0 0 15px rgba(216, 191, 216, 0.6);
            border-radius: 4px;
            /* âš ï¸ æ³¨æ„ï¼šè¿™é‡Œåˆ æ‰äº† CSS transitionï¼Œå…¨éƒ¨äº¤ç»™ JS æ§åˆ¶ï¼Œé˜²æ­¢å†²çª */
        }

        /* ä¸­å¿ƒäººç‰©å›¾ç‰‡ */
        #spin-container .center-anime {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%); /* ä¸­å¿ƒå›¾ä¸éœ€è¦æ—‹è½¬ translateZ */
            width: 100px; height: 100px;
            border: none; box-shadow: none; border-radius: 0;
            pointer-events: none;
        }

        /* åœ°æ¿ */
        #ground {
            width: 900px; height: 900px;
            position: absolute;
            top: 100%; left: 50%;
            transform: translate(-50%, -50%) rotateX(90deg);
            background: -webkit-radial-gradient(center center, farest-side, rgba(147, 112, 219, 0.15), transparent);
        }

        /* ====== é¡¶éƒ¨æ–‡å­—æ°”æ³¡ ====== */
        #msg-box {
            position: absolute;
            top: 15%; left: 50%;
            transform: translateX(-50%);
            width: 90%; max-width: 500px;
            text-align: center;
            z-index: 200; pointer-events: none;
        }
        .msg-content {
            display: inline-block;
            padding: 10px 25px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 30px;
            color: #fff;
            font-size: 1.1rem;
            letter-spacing: 1px;
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.5s ease;
        }
        .msg-content.active { opacity: 1; transform: translateY(0); }

        /* ====== åº•éƒ¨å›ºå®šæ–‡å­— ====== */
        #text-container {
            position: absolute; bottom: 30px; left: 0; width: 100%;
            text-align: center; color: #e6e6fa; z-index: 100; pointer-events: none;
        }
        .english-font { font-family: 'Dancing Script', cursive; font-size: 2.5rem; margin-bottom: 10px; text-shadow: 0 0 10px #9370db; }
        .chinese-font { font-size: 1.1rem; letter-spacing: 2px; font-weight: 300; min-height: 1.5em; }

        /* éŸ³ä¹æŒ‰é’® */
        .music-btn {
            position: fixed; top: 20px; right: 20px; width: 40px; height: 40px;
            background: rgba(255, 255, 255, 0.2); border: 1px solid rgba(255, 255, 255, 0.5);
            border-radius: 50%; display: flex; justify-content: center; align-items: center;
            cursor: pointer; z-index: 1000;
        }
        .music-btn.playing { background: rgba(255, 255, 255, 0.5); animation: rotateMusic 4s linear infinite; }

        @keyframes fly { 0% { transform: translateY(100vh) scale(0); opacity: 0; } 50% { opacity: 1; } 100% { transform: translateY(-100px) scale(1); opacity: 0; } }
        @keyframes rotateMusic { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div id="start-mask">
        <h1>To My Beloved Wife</h1>
        <div class="heart-container">
            <div class="heart-outer">
                <div class="heart-inner" id="heart-fill"></div>
                <div class="heart-icon">â¤ï¸</div>
            </div>
            <p class="heart-instruction">Hold to Enter</p>
        </div>
    </div>
    
    <div id="fireflies"></div>

    <div class="music-btn" onclick="toggleMusic()">ğŸµ</div>
    <audio id="bg-music" loop>
        <source src="music.mp3" type="audio/mpeg">
    </audio>

    <div id="msg-box">
        <div class="msg-content">Waiting for you...</div>
    </div>

    <div id="drag-container">
        <div id="spin-container">
            <img class="center-anime" src="./anime.png" alt="us">

            <img src="./1.jpg" data-text="é‚£å¤©é˜³å…‰æ­£å¥½ï¼Œå°±åƒé‡è§ä½ çš„å¿ƒæƒ…">
            <img src="./2.jpg" data-text="ä½ ç¬‘èµ·æ¥çš„æ ·å­ï¼Œæ˜¯æˆ‘æœ€ç¾çš„é£æ™¯">
            <img src="./3.jpg" data-text="ä¸ç®¡æ˜¯æ™´å¤©é›¨å¤©ï¼Œæœ‰ä½ åœ¨å°±æ˜¯å¥½å¤©">
            <img src="./4.jpg" data-text="è°¢è°¢ä½ ï¼ŒåŒ…å®¹æˆ‘çš„å°è„¾æ°”">
            <img src="./5.jpg" data-text="è¿™ä¸€è·¯èµ°æ¥ï¼Œè¾›è‹¦äº†æˆ‘çš„è€å©†å¤§äºº">
            <img src="./6.jpg" data-text="æœªæ¥å¾ˆé•¿ï¼Œæˆ‘ä»¬è¦æ…¢æ…¢èµ°">
            
        </div>
        <div id="ground"></div>
    </div>

    <div id="text-container">
        <div class="english-font">Happy Anniversary</div>
        <p class="chinese-font" id="type-text"></p>
    </div>

    <script>
        // ====== é…ç½®é¡¹ ======
        const RADIUS = 240;        // ç›¸å†ŒåŠå¾„ï¼Œè¶Šå¤§æ•°æ®è¶Šåˆ†æ•£
        const IMG_WIDTH = 120;     // ç…§ç‰‡å®½åº¦
        const IMG_HEIGHT = 170;    // ç…§ç‰‡é«˜åº¦
        const AUTO_SPIN_SPEED = 0.3; // æ—‹è½¬é€Ÿåº¦ (æ•°å€¼è¶Šå°è¶Šæ…¢)

        // ====== å˜é‡å£°æ˜ ======
        let tX = 0, tY = 10;       // å®¹å™¨æ—‹è½¬è§’åº¦
        let desX = 0, desY = 0;    // æ‹–æ‹½é€Ÿåº¦
        let isDragging = false;    // æ˜¯å¦åœ¨æ‹–æ‹½
        let isAutoSpin = false;    // æ˜¯å¦å¼€å¯è‡ªåŠ¨æ—‹è½¬
        let lastIndex = -1;        // ä¸Šä¸€æ¬¡æ˜¾ç¤ºçš„å›¾ç‰‡ç´¢å¼•

        // DOM å…ƒç´ è·å–
        const obox = document.getElementById('drag-container');
        const ospin = document.getElementById('spin-container');
        // è·å–æ‰€æœ‰æ™®é€šç…§ç‰‡ï¼ˆæ’é™¤ä¸­å¿ƒå›¾ï¼‰
        const aImg = ospin.getElementsByTagName('img');
        const aEle = [...aImg].filter(img => !img.classList.contains('center-anime'));
        const msgContent = document.querySelector('.msg-content');

        // è®¾ç½®å®¹å™¨å¤§å°
        ospin.style.width = IMG_WIDTH + "px";
        ospin.style.height = IMG_HEIGHT + "px";

        // ====== 1. åˆå§‹åŒ–ç›¸å†Œä½ç½® ======
        function initAlbum() {
            // ç»™æ¯ä¸€å¼ å›¾ç‰‡è®¡ç®—åŸºç¡€è§’åº¦
            aEle.forEach((img, i) => {
                const angle = i * (360 / aEle.length);
                // å°†åŸºç¡€è§’åº¦å­˜å…¥ datasetï¼Œæ–¹ä¾¿åç»­è¯»å–ï¼Œè¿™æ˜¯é˜²æ­¢å åœ¨ä¸€èµ·çš„å…³é”®ï¼
                img.dataset.baseAngle = angle; 
                
                // åˆå§‹è®¾ç½®ï¼Œé˜²æ­¢JSåŠ è½½æ…¢æ—¶å †å 
                img.style.transform = `rotateY(${angle}deg) translateZ(${RADIUS}px)`;
                img.style.transition = "opacity 1s, box-shadow 0.3s"; // åªåšé€æ˜åº¦åŠ¨ç”»ï¼Œä¸åštransformåŠ¨ç”»
                
                // ä¾æ¬¡å»¶è¿Ÿå‡ºç°ï¼Œæ›´æœ‰ä»ªå¼æ„Ÿ
                img.style.opacity = 0;
                setTimeout(() => { img.style.opacity = 1; }, 1000 + i * 200);
            });
        }

        // ====== 2. æ ¸å¿ƒæ¸²æŸ“å¾ªç¯ (è§£å†³æ‰€æœ‰å†²çªçš„ç»ˆææ–¹æ¡ˆ) ======
        // æ¯ä¸€å¸§ç”»é¢ï¼Œæˆ‘ä»¬éƒ½é‡æ–°è®¡ç®—ï¼šå®¹å™¨æ€ä¹ˆè½¬ï¼Ÿç…§ç‰‡æ€ä¹ˆå‘¼å¸ï¼Ÿ
        function renderFrame() {
            // A. å¤„ç†å®¹å™¨è‡ªåŠ¨æ—‹è½¬
            if (!isDragging && isAutoSpin) {
                tX -= AUTO_SPIN_SPEED;
            }

            // B. åº”ç”¨å®¹å™¨æ—‹è½¬
            // é™åˆ¶ tY ä¿¯ä»°è§’ï¼Œé˜²æ­¢è½¬åˆ°åœ°åº•ä¸‹
            if (tY > 180) tY = 180;
            if (tY < 0) tY = 0;
            obox.style.transform = `rotateX(${-tY}deg) rotateY(${tX}deg)`;

            // C. è®¡ç®—å‘¼å¸æ¯”ä¾‹ (åˆ©ç”¨æ—¶é—´æˆ³ç”Ÿæˆå¹³æ»‘çš„æ­£å¼¦æ³¢)
            const time = Date.now() * 0.002; // æ—¶é—´å› å­
            // scale åœ¨ 0.95 åˆ° 1.05 ä¹‹é—´æ³¢åŠ¨
            const scale = 1 + Math.sin(time) * 0.05; 

            // D. ç»™æ¯ä¸€å¼ ç…§ç‰‡åº”ç”¨ transform
            // å…³é”®ï¼šåŒæ—¶åº”ç”¨ "å›ºå®šçš„ä½ç½®" + "åŠ¨æ€çš„ç¼©æ”¾"
            aEle.forEach(img => {
                const baseAngle = parseFloat(img.dataset.baseAngle);
                // ç»„åˆå­—ç¬¦ä¸²ï¼šå…ˆæ—‹è½¬åˆ°ä½ç½®ï¼Œå†æ¨åˆ°åŠå¾„è·ç¦»ï¼Œæœ€ååº”ç”¨ç¼©æ”¾
                img.style.transform = `rotateY(${baseAngle}deg) translateZ(${RADIUS}px) scale(${scale})`;
                
                // ä¸ºäº†å¢åŠ ç¾æ„Ÿï¼Œä¹Ÿå¯ä»¥è®©é€æ˜åº¦å¾®å¾®å‘¼å¸
                img.style.opacity = 0.8 + Math.sin(time) * 0.2;
            });

            // E. è®¡ç®—å“ªå¼ å›¾åœ¨ C ä½ (ç”¨äºæ˜¾ç¤ºæ–‡å­—)
            checkActiveImage();

            // ä¸‹ä¸€å¸§ç»§ç»­å¾ªç¯
            requestAnimationFrame(renderFrame);
        }

        // ====== 3. è®¡ç®— C ä½æ–‡å­—é€»è¾‘ ======
        function checkActiveImage() {
            const anglePerImg = 360 / aEle.length;
            // ç®—å‡ºè½¬äº†å¤šå°‘æ ¼
            const index = Math.round(-tX / anglePerImg);
            // å¤„ç†è´Ÿæ•°å’Œå¾ªç¯
            const normalizedIndex = ((index % aEle.length) + aEle.length) % aEle.length;

            if (normalizedIndex !== lastIndex) {
                lastIndex = normalizedIndex;
                const text = aEle[normalizedIndex].getAttribute('data-text');
                updateText(text);
            }
        }

        function updateText(text) {
            if (!text) return;
            msgContent.classList.remove('active');
            setTimeout(() => {
                msgContent.innerText = text;
                msgContent.classList.add('active');
            }, 300);
        }

        // ====== 4. äº¤äº’ï¼šæ‹–æ‹½æ§åˆ¶ ======
        document.onpointerdown = function (e) {
            e = e || window.event;
            let sX = e.clientX, sY = e.clientY;
            isDragging = true;

            document.onpointermove = function (e) {
                e = e || window.event;
                let nX = e.clientX, nY = e.clientY;
                desX = nX - sX;
                desY = nY - sY;
                tX += desX * 0.1;
                tY += desY * 0.1;
                sX = nX; sY = nY;
            };

            document.onpointerup = function () {
                isDragging = false;
                document.onpointermove = null;
                document.onpointerup = null;

                // ç®€å•çš„æƒ¯æ€§æ¨¡æ‹Ÿ
                let inertia = setInterval(() => {
                    if (Math.abs(desX) < 0.5 && Math.abs(desY) < 0.5) {
                        clearInterval(inertia);
                    }
                    desX *= 0.95; desY *= 0.95;
                    tX += desX * 0.1; tY += desY * 0.1;
                }, 17);
            };
            return false;
        };

        // ====== 5. äº¤äº’ï¼šçˆ±å¿ƒé•¿æŒ‰å¼€åœº ======
        let heartTimer = null, fillProgress = 0;
        function initHeartInteraction() {
            const heartOuter = document.querySelector('.heart-outer');
            const heartFill = document.getElementById('heart-fill');
            const instruction = document.querySelector('.heart-instruction');

            heartOuter.addEventListener('pointerdown', (e) => {
                e.preventDefault();
                heartOuter.classList.add('active');
                instruction.textContent = "Keep Holding...";
                heartTimer = setInterval(() => {
                    fillProgress += 5; // åŠ å¿«ä¸€ç‚¹é€Ÿåº¦
                    const pct = Math.min(fillProgress, 100);
                    heartFill.style.height = pct + '%';
                    if (pct >= 100) {
                        clearInterval(heartTimer);
                        startJourney();
                    }
                }, 50);
            });

            const reset = () => {
                if (fillProgress < 100) {
                    clearInterval(heartTimer);
                    heartOuter.classList.remove('active');
                    instruction.textContent = "Hold to Enter";
                    fillProgress = 0;
                    heartFill.style.height = '0%';
                }
            };
            heartOuter.addEventListener('pointerup', reset);
            heartOuter.addEventListener('pointerleave', reset);
        }

        function startJourney() {
            const mask = document.getElementById('start-mask');
            const audio = document.getElementById('bg-music');
            const btn = document.querySelector('.music-btn');
            
            mask.style.opacity = '0';
            audio.play().then(() => btn.classList.add('playing')).catch(() => console.log("Audio requires interaction"));
            
            setTimeout(() => {
                mask.style.display = 'none';
                isAutoSpin = true; // å¼€å¯æ—‹è½¬
                setTimeout(typeWriter, 500); // å¼€å¯æ‰“å­—æœº
            }, 1500);
        }

        // ====== 6. æ‚é¡¹ç‰¹æ•ˆ (è¤ç«è™«ã€æ‰“å­—æœº) ======
        function createFireflies() {
            const container = document.getElementById('fireflies');
            for (let i = 0; i < 30; i++) {
                const fly = document.createElement('div');
                fly.className = 'firefly';
                fly.style.left = Math.random() * 100 + 'vw';
                fly.style.animationDuration = (Math.random() * 5 + 5) + 's';
                fly.style.animationDelay = Math.random() * 5 + 's';
                container.appendChild(fly);
            }
        }

        const loveWords = [
            "ä¸ä½ å…±åº¦çš„æ¯ä¸€å¤©ï¼Œéƒ½æ˜¯å¥‡è¿¹",
            "ä¸¤å§“è”å§»ï¼Œä¸€å ‚ç¼”çº¦",
            "è‰¯ç¼˜æ°¸ç»“ï¼ŒåŒ¹é…åŒç§°",
            "Happy Anniversary, My Love â¤ï¸"
        ];
        const typeText = document.getElementById('type-text');
        let wordIndex = 0, charIndex = 0, isDeleting = false;

        function typeWriter() {
            if (!typeText) return;
            const currentWord = loveWords[wordIndex];
            typeText.innerText = isDeleting ? currentWord.substring(0, charIndex - 1) : currentWord.substring(0, charIndex + 1);
            charIndex = isDeleting ? charIndex - 1 : charIndex + 1;
            
            let speed = isDeleting ? 50 : 150;
            if (!isDeleting && charIndex === currentWord.length) {
                speed = 2000; isDeleting = true;
            } else if (isDeleting && charIndex === 0) {
                isDeleting = false; wordIndex = (wordIndex + 1) % loveWords.length; speed = 500;
            }
            setTimeout(typeWriter, speed);
        }

        // éŸ³ä¹æ§åˆ¶
        window.toggleMusic = function() {
            const audio = document.getElementById('bg-music');
            const btn = document.querySelector('.music-btn');
            if (audio.paused) { audio.play(); btn.classList.add('playing'); }
            else { audio.pause(); btn.classList.remove('playing'); }
        };

        // ====== å¯åŠ¨ ======
        document.addEventListener('DOMContentLoaded', () => {
            initHeartInteraction();
            createFireflies();
            // å»¶è¿Ÿåˆå§‹åŒ–ç›¸å†Œä½ç½®ï¼Œç¡®ä¿DOMå°±ç»ª
            setTimeout(initAlbum, 100);
            // å¯åŠ¨æ¸²æŸ“å¾ªç¯
            renderFrame();
        });

    </script>
</body>
</html>